# Person Tracking

Проект нацелен на разработку инструмента для отслеживание нужного человека на видеопотоке. Также для слежения за ним с помощью PTZ камеры.

## Technology stack

- OpenCV (https://github.com/opencv/opencv)
- Sort (https://github.com/mcximing/sort-cpp)
- TrueConf Room (https://trueconf.ru/products/room.html)
- Person ReID (https://github.com/ReID-Team/ReID_extra_testdata)
- Qt (https://www.qt.io/)

## Installation

1) Собрать OpenCV https://docs.opencv.org/master/d3/d52/tutorial_windows_install.html
2) Установить переменную среды ```OPENCV_DIR``` к папке, где находятся папки ```lib``` и ```bin```. Желательно просто указать в месте папки билда (к примеру ```/build/install/x64/vc16```)
3) Установить переменную среды ```QT_DIR_X64``` к папке с Qt
4) Настрока проекта

```sh
git clone https://github.com/Mitsko/PersonTracking.git
cd PersonTracking
mkdir build && cd build
cmake-gui ..
```

Далее сконфигурировать и сгенерировать проект (версию для линукс добавлю позже).

## Краткий обзор по проекту

Весь алгоритм трекинга проходит в несколько этапов. 
1) Для начала бы обучаем наш SVM классификатор с помощью модели ```ReID``` на нужного человека (для этого нам надо несколько его фото и набор фото с разными людьми, для того чтобы научить классификатор отличать нашего челвоека от других людей. Используем датасет ```Marknet```)
2) Далее стоит задача для получения кадров из ```Trueconf Room```. Для этого по WebSocket'ам мы сначала получаем ключ и порт для обмена сообщениями с http сервером. И далее с помощью ```GET``` запроса мы получаем кадр. 
3) Далее этот кадр мы прогоняем через модель для распознования образов```YoloV4-light```, чтобы найти в кадре всех людей.
4) Всю информацию с кадра мы передаем в трекер ```SORT``` - он позволяет по предыдущем кадрам предсказывать где окажется обхъект, и на основе предсказания мы можем трекать людей.
5) Паралелльно с 4 пунктом, всех найденных людей мы скармливаем модели для нахождения нужного человека.
6) И если человек найден, по его координатам, мы стараемся удерживать его в кадре. Для этого мы управлеям камерой по веб сокетам (используя API ```TrueConf Room```).

## Цели и проблемы
1) В целях снижения нагрузки для трекинга нам достаточно 5 фпс, но появляется проблема управления камерой, так как при больших скоростях поворота, камера не всегда останавливается, когда человек в кадре. Для решения этой проблемы, мы также будем использовать тот же алгоритм, что и для трекинга людей, мы будем предсказывать по последним данным, положения челвоека в кадре и вовремя останавливать камеру.
2) Нет отдельного управления по оси Х и по оси Y. В будущем эта проблема решится введением нового функционала в API.
3) Нет управления скорость камеры при повороте. Также в будущем будет вводиться данный функционал.
4) Вырезания Qt из проекта и замена его на Boost. В данный момент для общения по WebSocket'ам и получения кадра средством GET запроса используется Framework Qt. Он слишком избыточен, для этого будем использовать буст.
5) Замена OpenCV на более оптимизированный фрейморк. Данный фреймворк не устраивает скоростью работы, распознования людей на фото на один кадр занимает 0.12- 0.15с, что очень мало, а судя по форумам, можно добиться куда большей произодительности.
6) Сборка под линукс и тестирование на ```Jetson Nano```
7) Замена модели для ReId людей. 
8) Оптимизация SVM  классификатора.


